<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>Metric Capture</title>
    <link href='/webjars/bootstrap/css/bootstrap.min.css' rel='stylesheet'>
    <link href='/webjars/jquery-ui/jquery-ui.min.css' rel='stylesheet'>
    <script th:inline="javascript">
        /*<![CDATA[*/

        var team = /*[[${slug}]]*/ 'all';
        console.log('team: ' + team);

        /*]]>*/
    </script>
    <style type="text/css">
        input {
            display: block;
            font-size: 11px;
            padding: 4px 2px;
            border: solid 1px #aacfe4;
            width: 70px;
            margin: 2px 0 20px 10px;
        }

        #message {
            display: block;
            font-size: 11px;
            padding: 4px 2px;
            border: solid 1px darkred;
            width: 70px;
            margin: 2px 0 20px 10px;
        }

    </style>
</head>
<body>
<div><a th:href="@{/dashboard/{slug}/(slug=${slug})}"><span>Dashboard</span></a></div>
<div><h1>Metric Capture</h1></div>
<span id="message"></span>
<form id="metric_capture">
    <label for="date">Date</label><input type="text" id="date" name="date">
    <label for="cycletime">Cycle Time (days)</label><input type="text" id="cycletime" name="cycletime">
    <label for="deployment_frequency">Deployment Frequency (days)</label><input type="text" id="deployment_frequency"
                                                                         name="deployment_frequency">
    <label for="incidents_due_to_change">Incidents due to change</label><input type="text" id="incidents_due_to_change"
                                                                               name="incidents_due_to_change">
    <label for="production_defects">Production Defects</label><input type="text" id="production_defects"
                                                                     name="production_defects">
    <label for="team_happiness">Team Happiness</label><input id="team_happiness" name="team_happiness"
                                                             type="text">
    <label for="customer_satisfaction">Customer Satisfaction</label><input id="customer_satisfaction"
                                                                           name="customer_satisfaction"
                                                                           type="text">
    <input type="submit" value="Submit">
</form>
<script src="/webjars/jquery/jquery.min.js" type="text/javascript"></script>
<script src="/webjars/popper.js/umd/popper.min.js" type="text/javascript"></script>
<script src="/webjars/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/webjars/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
<script type="text/javascript">

    $(document).ready(function () {
        $("#date").datepicker({
            dateFormat: "yy-mm-dd"
        });
    });

    var frm = $('#metric_capture');

    frm.submit(function (e) {

        e.preventDefault();

        $("#metric_capture input[type=text]").each(function () {
            if (this.name === 'date' || this.value === "") {
                console.log(this.name + ': skip field');
                return;
            }
            $.ajax({
                method: "GET",
                url: "/metrics/" + this.name + "/" + team + "/" + $("#date").val() + "/" + this.value,
                success: function (url) {
                    console.log(url + ': Submission was successful.');
                },
                error: function (url) {
                    console.log(url + ': An error occurred.');
                }
            });
        });
        $("#message").text("Metrics Submitted");
        return false;

    });

    $("#date").change(function () {
        $("#metric_capture input[type=text]").each(function () {

            var elementid = this.id;

            if (this.name === 'date') {
                console.log(this.name + ': skip field');
                return;
            } else {
                $("#" + elementid).val("");
            }

            function success_cb(data) {
                if (data !== "") {
                    console.log(elementid + " : " + data.value);
                    $("#" + elementid).val(data.value);
                }
            }

            $.ajax({
                method: "GET",
                url: "/metrics/" + this.name + "/" + team + "/" + $("#date").val(),
                success: function (data) {
                    success_cb(data);
                },
                error: function (data) {
                    console.log(data);
                }
            });
        });
    });
</script>
</body>
</html>